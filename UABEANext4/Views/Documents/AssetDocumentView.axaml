<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             xmlns:docs="using:UABEANext4.ViewModels.Documents"
             xmlns:uac="using:UABEANext4.Converters"
             xmlns:ws="using:UABEANext4.AssetWorkspace"
             x:Class="UABEANext4.Views.Documents.AssetDocumentView"
             x:DataType="docs:AssetDocumentViewModel">
  <Grid Background="#252526">
    <Grid.Resources>
      <uac:AssetTypeIconConverter x:Key="AssetTypeIconConverter" />
    </Grid.Resources>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- Toolbar -->
    <Border Grid.Row="0" Background="#2a2a2c" CornerRadius="8" Margin="8,8,8,4" Padding="8,6">
      <StackPanel Orientation="Horizontal" Spacing="4">
        <Button Command="{Binding ViewScene}" Padding="10,6">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <Image Source="avares://UABEANext4/Assets/Icons/action-view-scene.png" Width="16" Height="16" />
            <TextBlock Text="View Scene" VerticalAlignment="Center" />
          </StackPanel>
        </Button>
        <Button Command="{Binding Export}" Padding="10,6">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <Image Source="avares://UABEANext4/Assets/Icons/action-export-asset.png" Width="16" Height="16" />
            <TextBlock Text="Export" VerticalAlignment="Center" />
          </StackPanel>
        </Button>
        <Button Command="{Binding Import}" Padding="10,6">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <Image Source="avares://UABEANext4/Assets/Icons/action-import-asset.png" Width="16" Height="16" />
            <TextBlock Text="Import" VerticalAlignment="Center" />
          </StackPanel>
        </Button>
        <Button Command="{Binding EditDump}" Padding="10,6">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <Image Source="avares://UABEANext4/Assets/Icons/action-view-info.png" Width="16" Height="16" />
            <TextBlock Text="Edit Data" VerticalAlignment="Center" />
          </StackPanel>
        </Button>
        <Button Command="{Binding ShowPlugins}" Name="showPluginsBtn" Padding="10,6">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <Image Source="avares://UABEANext4/Assets/Icons/action-plugins.png" Width="16" Height="16" />
            <TextBlock Text="Plugins" VerticalAlignment="Center" />
          </StackPanel>
          <Button.Flyout>
            <MenuFlyout ItemsSource="{Binding PluginsItems}">
              <MenuFlyout.ItemContainerTheme>
                <ControlTheme TargetType="MenuItem" BasedOn="{StaticResource {x:Type MenuItem}}" x:DataType="docs:PluginItemInfo">
                  <Setter Property="Header" Value="{Binding Name}"/>
                  <Setter Property="Command" Value="{Binding Execute}"/>
                  <Setter Property="CommandParameter" Value="{Binding $parent[UserControl].((docs:AssetDocumentViewModel)DataContext).SelectedItems}"/>
                </ControlTheme>
              </MenuFlyout.ItemContainerTheme>
            </MenuFlyout>
          </Button.Flyout>
        </Button>
        <Rectangle Width="1" Fill="#404042" Margin="8,4" />
        <Button Command="{Binding AddAsset}" Padding="10,6">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <Image Source="avares://UABEANext4/Assets/Icons/action-add-asset.png" Width="16" Height="16" />
            <TextBlock Text="Add" VerticalAlignment="Center" />
          </StackPanel>
        </Button>
        <Button Command="{Binding RemoveAsset}" Padding="10,6">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <Image Source="avares://UABEANext4/Assets/Icons/action-remove-asset.png" Width="16" Height="16" />
            <TextBlock Text="Remove" VerticalAlignment="Center" />
          </StackPanel>
        </Button>
      </StackPanel>
    </Border>

    <!-- Search Bar -->
    <Border Grid.Row="1" Background="#2a2a2c" CornerRadius="6" Margin="8,4,8,4" Padding="8,6">
      <Grid ColumnDefinitions="*,8,Auto">
        <TextBox Grid.Column="0" Text="{Binding SearchText}" Watermark="Search assets by name..." />
        <Button Grid.Column="2" Padding="10,6">
          <StackPanel Orientation="Horizontal" Spacing="6">
            <Image Source="avares://UABEANext4/Assets/Icons/action-filter.png" Width="16" Height="16" />
            <TextBlock Text="Filters" VerticalAlignment="Center" />
          </StackPanel>
          <Button.Flyout>
            <Flyout>
              <Border Background="#2a2a2c" CornerRadius="8" Padding="12" MinWidth="220">
                <StackPanel Spacing="8">
                  <TextBlock Text="Filters" FontWeight="SemiBold" Foreground="#e0e0e0" />
                  <Button Command="{Binding SetTypeFilter}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center">Set type filter</Button>

                  <Rectangle Height="1" Fill="#404042" Margin="0,4" />

                  <TextBlock Text="Search settings" FontWeight="SemiBold" Foreground="#e0e0e0" />
                  <CheckBox IsChecked="{Binding $parent[UserControl].((docs:AssetDocumentViewModel)DataContext).IsSearchCaseSensitive}" Foreground="#e0e0e0">Case sensitive</CheckBox>
                  <ListBox Classes="RadioButtonListBox" SelectedIndex="{Binding SearchKind}" Background="Transparent">
                    <ListBoxItem Tag="Search plainly">Plain search</ListBoxItem>
                    <ListBoxItem Tag="Search with regex (slow!)">Regex search</ListBoxItem>
                  </ListBox>
                </StackPanel>
              </Border>
            </Flyout>
          </Button.Flyout>
        </Button>
      </Grid>
    </Border>

    <!-- Data Grid -->
    <Border Grid.Row="2" Background="#1e1e1e" CornerRadius="8" Margin="8,4,8,8">
      <DataGrid AutoGenerateColumns="False" CanUserResizeColumns="True" CanUserReorderColumns="True"
                IsReadOnly="True" ItemsSource="{Binding CollectionView}" x:DataType="docs:AssetDocumentViewModel"
                SelectionChanged="DataGrid_SelectionChanged" Name="dataGrid" Background="Transparent"
                Margin="4">
        <DataGrid.RowTheme>
          <ControlTheme TargetType="DataGridRow" BasedOn="{StaticResource {x:Type DataGridRow}}">
            <ControlTheme.Children>
              <Style Selector="^:nth-child(2n)">
                <Setter Property="Background" Value="#00FFFFFF" />
              </Style>
            </ControlTheme.Children>
          </ControlTheme>
        </DataGrid.RowTheme>
        <DataGrid.Columns>
          <DataGridTemplateColumn Header=" " Width="32">
            <DataGridTemplateColumn.CellTemplate>
              <DataTemplate x:DataType="ws:AssetInst">
                <Image Source="{Binding Type, Converter={StaticResource AssetTypeIconConverter}}" Width="16" Height="16" Margin="8,0,0,0" />
              </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
          </DataGridTemplateColumn>

          <DataGridTextColumn Header="Name" Width="150" Binding="{Binding DisplayName}" x:DataType="ws:AssetInst"/>
          <DataGridTextColumn Header="Type" Width="120" Binding="{Binding Type}" x:DataType="ws:AssetInst"/>
          <DataGridTextColumn Header="Container" Width="100" Binding="{Binding DisplayContainer}" x:DataType="ws:AssetInst" IsVisible="{Binding $parent[UserControl].((docs:AssetDocumentViewModel)DataContext).LoadContainers}"/>
          <DataGridTextColumn Header="Bundle Name" Width="120" Binding="{Binding BundleName}" x:DataType="ws:AssetInst" IsVisible="False"/>
          <DataGridTextColumn Header="File Name" Width="120" Binding="{Binding FileName}" x:DataType="ws:AssetInst"/>
          <DataGridTextColumn Header="Path ID" Width="130" Binding="{Binding PathId}" x:DataType="ws:AssetInst"/>
          <DataGridTextColumn Header="Size" Width="80" Binding="{Binding ByteSizeModified}" x:DataType="ws:AssetInst"/>
          <DataGridTextColumn Header="Modified" Binding="{Binding ModifiedString}" x:DataType="ws:AssetInst"/>
        </DataGrid.Columns>
      </DataGrid>
    </Border>
  </Grid>
</UserControl>
